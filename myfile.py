# -- coding: utf-8 --
"""myfile

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15e-V4gddIhN9kVunjOiHNkcsxjzHTuap
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px
import plotly.graph_objects as go
from streamlit_option_menu import option_menu

# Configuraci칩n de la p치gina de Streamlit
st.set_page_config(page_title="Deforestaci칩n en 츼reas Naturales Protegidas", page_icon="游꺕", initial_sidebar_state="expanded", layout='wide')

st.title('Huellas de la deforestaci칩n')
st.header("Rastreando el impacto de la p칠rdida forestal en Per칰 a travez del tiempo")
st.write('La deforestaci칩n en Per칰 es un fen칩meno alarmante que ha capturado la atenci칩n de ambientalistas, cient칤ficos y gobiernos por igual. Este pa칤s, hogar de una de las partes m치s ricas en biodiversidad del planeta, enfrenta una creciente amenaza debido a la tala indiscriminada de bosques, impulsada por actividades como la miner칤a y la expansi칩n urbana. En este caso, analizaremos un registro de monitoreo de la Deforestaci칩n en el 치mbito de las 츼reas Naturales, para dar conocimiento especificos sobre ello y generar un an치lisis.')
st.write("El Registro de Monitoreo de la Deforestaci칩n en el 치mbito de las 츼reas Naturales Protegidas es una herramienta fundamental gestionada por el Servicio Nacional de 츼reas Naturales Protegidas por el Estado (SERNANP) en Per칰. Este organismo, adscrito al Ministerio del Ambiente, tiene como misi칩n asegurar la conservaci칩n de las 치reas protegidas del pa칤s, as칤 como la diversidad biol칩gica y el mantenimiento de sus servicios ambientales. A trav칠s de sistemas de informaci칩n geogr치fica y t칠cnicas de monitoreo biol칩gico, SERNANP recopila y analiza datos sobre la deforestaci칩n y otros cambios en el uso del suelo dentro de estas 치reas. Este registro no solo permite identificar las tendencias de p칠rdida de cobertura forestal, sino que tambi칠n facilita la implementaci칩n de estrategias de conservaci칩n y gesti칩n sostenible, contribuyendo as칤 a la protecci칩n de los ecosistemas y a la mitigaci칩n de los efectos del cambio clim치tico. La informaci칩n obtenida es crucial para la toma de decisiones informadas y para el foralecimiento de las pol칤ticas ambientales en el pa칤s.")
st.write("De tal forma, nos enfocaremos en el monitoreo de la deforestaci칩n dentro de las 츼reas Naturales Protegidas. Examinaremos datos generales que ilustran la tasa de deforestaci칩n y las tendencias a lo largo del tiempo, as칤 como las implicancias de estas p칠rdidas en la conservaci칩n de la biodiversidad.")

archivo = "Dataset_DeforestacionAnp_SERNANP.csv"
data = pd.read_csv(archivo)

# Mostrar los datos
st.write("Vista previa de los datos:")
st.dataframe(data)

# Funci칩n para filtrar y procesar los datos por a침o
def procesar_datos_por_anio(data, anio):
    meses = {
        1: 'Enero', 2: 'Febrero', 3: 'Marzo', 4: 'Abril', 5: 'Mayo', 6: 'Junio',
        7: 'Julio', 8: 'Agosto', 9: 'Septiembre', 10: 'Octubre', 11: 'Noviembre', 12: 'Diciembre'
    }
    datos_anio = data[data['ANIO_REPORTE'] == anio]
    area_por_mes = datos_anio.groupby('MES_IMAG')['AREA_DEFO'].sum().reset_index()
    area_por_mes = area_por_mes.sort_values(by='MES_IMAG')
    area_por_mes['MES_NOMBRE'] = area_por_mes['MES_IMAG'].map(meses)
    return area_por_mes, datos_anio

# Funci칩n para mostrar gr치ficos y tablas
def graficos_y_tabla1(data_anio, datos_filtrados, anio, color):
    # Gr치fico
    st.write(f"Gr치fico del 치rea deforestada por mes en {anio}:")
    fig, ax = plt.subplots()
    ax.plot(data_anio['MES_NOMBRE'], data_anio['AREA_DEFO'], marker='o', linestyle='-', color=color)
    ax.set_title(f'츼rea deforestada por mes en {anio}')
    ax.set_xlabel('Mes')
    ax.set_ylabel('츼rea Deforestada (ha)')
    ax.grid(True)
    plt.xticks(rotation=45)
    st.pyplot(fig)

    # Tabla
    st.write(f"Datos filtrados para el a침o {anio}:")
    st.dataframe(datos_filtrados[['MES_IMAG', 'ANIO_REPORTE', 'AREA_DEFO']])
    
# Filtrar y procesar datos para 2022 y 2023
data_2021, datos_filtrados_2021 = procesar_datos_por_anio(data, 2021)
data_2022, datos_filtrados_2022 = procesar_datos_por_anio(data, 2022)
data_2023, datos_filtrados_2023 = procesar_datos_por_anio(data, 2023)

# Combo box (a침o)
seleccion_anio = st.selectbox("Selecciona el a침o para mostrar el gr치fico", [2021, 2022, 2023])

# Mostrar gr치ficos y tablas seg칰n la selecci칩n
if seleccion_anio == 2021:
    graficos_y_tabla1(data_2021, datos_filtrados_2021, 2021, 'orange')
elif seleccion_anio == 2022:
    graficos_y_tabla1(data_2022, datos_filtrados_2022, 2022, 'green')
elif seleccion_anio == 2023:
    graficos_y_tabla1(data_2023, datos_filtrados_2023, 2023, 'blue')

# Gr치fico comparativo entre a침os
st.write("Comparaci칩n de 치rea deforestada entre 2021, 2022 y 2023:")
promedios = pd.DataFrame({
    "A침o": ["2021", "2022", "2023"],
    "Promedio Mensual (ha)": [
        data_2021['AREA_DEFO'].mean(),
        data_2022['AREA_DEFO'].mean(),
        data_2023['AREA_DEFO'].mean()
    ]
})

fig, ax = plt.subplots()
ax.bar(promedios['A침o'], promedios['Promedio Mensual (ha)'], color=['orange', 'green', 'blue'])
ax.set_title('Promedio mensual de 치rea deforestada (2021-2023)')
ax.set_xlabel('A침o')
ax.set_ylabel('츼rea Deforestada (ha)')
st.pyplot(fig)    


# Gr치fico de pastel para causa de deforestaci칩n
st.write("Causa de la deforestaci칩n")

# Agrupaci칩n de datos por causa
area_causa = data.groupby('DEFO_CAUSA')['AREA_DEFO'].sum().reset_index()
area_causa = area_causa.sort_values('AREA_DEFO', ascending=False)  # Ordenar por 치rea

# Colores uniformes que combinen con gr치ficos anteriores
colores = ['#FFA07A', '#90EE90', '#87CEEB', '#4682B4']  # Tonos similares al resto

# Crear gr치fico
fig3, ax3 = plt.subplots()

# Gr치fico de pastel 
ax3.pie(area_causa['AREA_DEFO'], labels=None, autopct='%1.1f%%', startangle=90, colors=colores, wedgeprops={'edgecolor': 'black'})
ax3.axis('equal')  # Asegurar que sea un c칤rculo perfecto

# Leyenda 
ax3.legend(area_causa['DEFO_CAUSA'], title="Causas de la deforestaci칩n", bbox_to_anchor=(1.05, 1), loc='upper left')

# Mostrar el gr치fico en Streamlit
st.pyplot(fig3)

# Tabla de datos
st.write("Datos de causa de deforestaci칩n y 치rea deforestada:")
st.dataframe(area_causa)


# Gr치fico de barras horizontales para zonificaci칩n
st.write("Distribuci칩n de la deforestaci칩n por zonificaci칩n en el 츼rea Natural Protegida (ANP)")

area_zonificacion = data.groupby("ZONIFI_ANP")['AREA_DEFO'].sum().reset_index()

area_zonificacion = area_zonificacion.sort_values('AREA_DEFO', ascending=True)

#  gr치fico
fig4, ax4 = plt.subplots(figsize=(8, 6))
ax4.barh(area_zonificacion['ZONIFI_ANP'], area_zonificacion['AREA_DEFO'], color='teal')
ax4.set_title('츼rea deforestada por zonificaci칩n', fontsize=16)
ax4.set_xlabel('츼rea deforestada (km)', fontsize=12)
ax4.set_ylabel('Zonificaci칩n ANP', fontsize=12)
ax4.grid(axis='x', linestyle='--', alpha=0.7)

st.pyplot(fig4)

area_zonificacion_renombrada = area_zonificacion[['ZONIFI_ANP', 'AREA_DEFO']].rename(columns={
    'ZONIFI_ANP': 'Zonificaci칩n ANP',
    'AREA_DEFO': '츼rea deforestada (km)'
})

# Mostrar tabla 
st.write("Datos de 치rea deforestada por zonificaci칩n:")
st.dataframe(area_zonificacion_renombrada)


#gr치fico 04

def graficos_y_tabla4():
    # Filtrar los datos para el per칤odo 2021-2023
    df_filtered = data[(data["ANIO_REPORTE"] >= 2021) & (data["ANIO_REPORTE"] <= 2023)]
    
    # Asegurar que los datos est치n disponibles
    if df_filtered.empty:
        st.warning("No se encontraron datos para el per칤odo 2021-2023.")
        return
    
    # Agrupar y sumar el 치rea deforestada por ANP
    sum_area_deforestation = df_filtered.groupby("ANP")["AREA_DEFO"].sum().reset_index()
    sum_area_deforestation.rename(columns={"AREA_DEFO": "츼rea Deforestada (ha)"}, inplace=True)
    
    # Crear el gr치fico de dispersi칩n
    fig5 = px.scatter(
        sum_area_deforestation, 
        x="ANP", 
        y="츼rea Deforestada (ha)", 
        size="츼rea Deforestada (ha)", 
        color="ANP", 
        hover_name="ANP", 
        title="츼rea Deforestada (ha) por ANP (2021-2023)",
        labels={"ANP": "츼rea Natural Protegida", "츼rea Deforestada (ha)": "츼rea Deforestada (ha)"},
        size_max=60,
        color_discrete_sequence=px.colors.qualitative.Set3
    )
    
    # Actualizar dise침o del gr치fico
    fig5.update_yaxes(title_text="츼rea Deforestada (ha)")
    fig5.update_layout(
        xaxis=dict(title='츼rea Natural Protegida', tickangle=-45),
        yaxis=dict(title='츼rea Deforestada (ha)'),
        font=dict(family="Arial", size=12),
    )
    
    # Mostrar el gr치fico y una descripci칩n
    st.plotly_chart(fig5)
    st.markdown("*Gr치fica: El gr치fico muestra la cantidad de 치rea deforestada en hect치reas (ha) para cada 츼rea Natural Protegida durante el per칤odo 2021-2023.*")
    st.warning(
        'El gr치fico resalta que las 치reas naturales protegidas con mayor deforestaci칩n deben ser objeto de pol칤ticas urgentes para mitigar la p칠rdida de biodiversidad y el impacto ambiental.',
        icon="游꺔"
    )


